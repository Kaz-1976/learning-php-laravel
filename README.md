# ECサイト ポートフォリオ

## 概要

このプロジェクトは、PHP学習の一環としてフレームワークなしで作成した簡易的な会員制ECサイトを、Laravelを用いて全面的に再構築したものです。単なる機能実装だけでなく、Oracle Cloudを活用したインフラ構築にも挑戦し、Webアプリケーション開発における幅広いスキル習得を目指しました。この経験を通して、より堅牢でスケーラブルなアプリケーション開発の基礎を習得できたと考えています。

## 開発期間

  * 基本機能再構築: 2024年8月～2024年10月 (Laravel学習と並行)
  * インフラ構築: 2024年11月～2024年11月
  * 追加機能開発: 2025年2月～2025年4月

## 成果物

  * **サイトURL**: [https://learning.inaho.space/](https://learning.inaho.space/)
  * **GitHubリポジトリ**: [https://github.com/Kaz-1976/learning-php-laravel](https://github.com/Kaz-1976/learning-php-laravel)

## 使用技術

  * **開発言語**: PHP, JavaScript, HTML, CSS
  * **フレームワーク**: Laravel
  * **ミドルウェア**: MySQL, Nginx, Node.js, Docker
  * **インフラストラクチャ**: Oracle Cloud

## 機能概要

このECサイトは、ユーザーと管理者の両方が利用できる会員制のシステムとして設計されています。

### 基本機能

| 分類         | 画面                       | 機能                                       | 備考                                             |
| :----------- | :------------------------- | :----------------------------------------- | :----------------------------------------------- |
| ログイン     | ログイン                   | 管理ユーザーログイン、一般ユーザーログイン | ログイン成功時は管理メニューまたは商品一覧へ遷移 |
| ログアウト   | ログアウト                 | ログアウト                                 |                                                  |
| ユーザー登録 | ユーザー情報登録           |                                            |                                                  |
| ユーザー管理 | ユーザー情報一覧           |                                            |                                                  |
|              | ユーザー情報登録           |                                            |                                                  |
|              | ユーザー情報更新           |                                            |                                                  |
|              | 有効フラグ更新             |                                            |                                                  |
|              | 管理フラグ更新             |                                            |                                                  |
| 商品管理     | 商品情報一覧               | 商品画像取得API(商品情報)使用              |                                                  |
|              | 商品情報登録               |                                            |                                                  |
|              | 商品情報更新               |                                            |                                                  |
|              | 公開フラグ更新             |                                            |                                                  |
| 買い物       | 商品一覧                   | ショッピングカートに追加                   | 商品画像取得API(商品情報)使用                    |
|              | カート内の商品一覧         |                                            |                                                  |
|              | カート内の商品削除         |                                            |                                                  |
|              | カート内を空にする         |                                            |                                                  |
|              | カート内の商品注文数量更新 |                                            |                                                  |
|              | カート内の商品購入         |                                            |                                                  |
| 購入完了     | 購入商品一覧               |                                            |                                                  |

### 追加機能

| 分類               | 画面                          | 機能                                     | 備考                              |
| :----------------- | :---------------------------- | :--------------------------------------- | :-------------------------------- |
| ログイン処理       | ログイン処理                  | APIアクセス用トークン取得処理等          |                                   |
| パスワードリセット | パスワードリセット要求        | 登録メールアドレスにリセット用リンク送信 |                                   |
|                    | パスワードリセット実施        | パスワード更新                           |                                   |
| 買い物             | 配送先選択                    | 配送先選択、配送先登録                   | 配送先取得API、住所取得API使用    |
| 注文確認           | 注文商品一覧                  |                                          | 商品画像取得API(商品情報)使用     |
| マイページ         | マイページ                    | プロフィール編集、配送先管理、購入履歴   |                                   |
| 個人情報管理       | 個人情報更新                  |                                          |                                   |
| 配送先管理         | 配送先表示                    |                                          |                                   |
|                    | 配送先登録                    |                                          | 住所取得API使用                   |
|                    | 配送先更新                    |                                          | 住所取得API使用                   |
|                    | 配送先削除                    |                                          |                                   |
| 購入履歴           | 購入履歴一覧                  |                                          |                                   |
|                    | 購入履歴詳細                  | 購入履歴詳細                             | 商品画像取得API(レシート明細)使用 |
| API                | 住所取得API                   | 郵便番号に紐付いた住所情報を取得         |                                   |
|                    | 配送先取得API                 | 配送先IDに紐付いた配送先情報を取得       |                                   |
|                    | 商品画像取得API(商品情報)     | 商品に紐付いた商品画像を取得             |                                   |
|                    | 商品画像取得API(レシート明細) | レシート明細に紐付いた商品画像を取得     |                                   |

## 画面遷移図

![画面遷移図](documents\画面遷移図.drawio.png)

## 機能詳細

### ユーザー関連機能

ユーザーは一般ユーザーと管理ユーザー (スーパーユーザー、個別ユーザー)に分類され、それぞれ可能な操作が異なります。

  * **スーパーユーザー**: 環境変数で初期設定され、ユーザーの管理権限設定が可能です。システム全体の管理を担います。
  * **管理ユーザー**: スーパーユーザーによって登録され、通常の管理作業を行います。
  * **一般ユーザー**: ユーザー登録機能またはユーザー管理機能で登録し、ログイン後に買物ができます。

**各機能の詳細**

  * **ユーザー登録機能**: 一般ユーザーが新規利用を開始する際に情報を登録し、ログインを可能にします。登録されたユーザーはすべて一般ユーザーとして扱われます。
  * **ユーザー管理機能**: 管理ユーザーがシステムに登録されているユーザー情報を編集できます。管理権限の設定や管理ユーザーの新規作成はスーパーユーザーのみ可能です。
  * **ユーザーログイン機能**: ログイン画面にてユーザーIDとパスワードを入力することでサイトにログインできます。ログイン完了後は、一般ユーザーは商品一覧画面へ、管理ユーザーは管理メニュー画面へ自動遷移します。

### 商品管理機能

スーパーユーザー以外の管理ユーザーが、商品の新規登録、既存商品の価格設定、在庫管理、公開可否設定を行います。これにより、サイトの商品情報を柔軟に管理できます。

### 商品一覧機能

一般ユーザーが利用する画面です。商品管理画面で公開設定された商品が一覧表示され、選択した商品をショッピングカートに追加できます。視覚的に分かりやすい商品表示を心がけました。

### ショッピングカート機能

ショッピングカート内の商品の購入、数量変更、削除、カートを空にする操作が可能です。ユーザーがスムーズに購入手続きを進められるよう設計しました。

### パスワードリセット機能

登録されているメールアドレスにパスワードリセット用リンクを送信し、ユーザー自身がパスワードをリセットできるようにします。セキュリティと利便性を両立させました。

### マイページ機能

ログイン中のユーザー専用のページで、以下の機能を提供します。

  * **個人情報編集機能**: パスワード変更を含む個人情報の編集。
  * **配送先管理機能**: 配送先情報の登録・修正・削除。
  * **購入履歴表示機能**: 注文ごとの購入履歴表示。

### 住所自動入力機能

入力された郵便番号に紐付く住所を自動的に入力します。この機能はAPIとして実装されており、フロントエンドから呼び出すことで住所情報を返します。郵便番号データは日本郵便が公開しているデータをインポートして使用しています。これにより、ユーザーの手間を削減し、入力ミスも軽減しました。

  * 郵便番号データ入手先URL: [https://www.post.japanpost.jp/zipcode/dl/utf-zip.html](https://www.post.japanpost.jp/zipcode/dl/utf-zip.html)

## 工夫した点

  * **インフラストラクチャの構築**: Oracle Cloudのコンピュート・インスタンス上にDocker Composeで環境を構築しました。データベースにはMySQL Database、メール送信にはEmail Delivery Serviceをそれぞれ利用することで、クラウドサービスを活用した効率的なインフラ構築を実践し、スケーラビリティと運用性を考慮しました。
  * **セキュリティ対策**: WebサーバーでLet's Encryptの証明書によるTLS対応を行い、サイトへの接続を保護しました。Let's Encrypt証明書の有効期間が短いため自動更新処理も実装しています。また、パスワードハッシュ化、CSRF対策、XSS対策、SQLインジェクション対策を徹底しました。APIとして実装した機能についても、多角的な視点からセキュリティを考慮した設計を行っています。
  * **ユーザー体験向上(UX改善)**:
      * **画像プレビュー機能**: 登録する画像を選択した時点で画面に表示することで、事前に画像を確認できるようにしました。これにより、ユーザーは安心して画像をアップロードできます。
      * **画像ロードの高速化**: 画像へのアクセスをAPI化し、画像データをHTMLに直接含めないことで、ページと画像の表示効率化を図りました。
      * **郵便番号からの住所検索機能**: 郵便番号を入力するだけで住所が自動入力されるようにすることで、ユーザーの手間を削減し、入力ミスも軽減しました。
  * **レスポンシブ対応**: 画面幅に応じてレイアウトが自動的に最適化されるように設計し、スマートフォンからデスクトップまで、様々なデバイスで快適に利用できるようにしました。
  * **ダークモード対応**: システムにあわせて配色を切り替えるダークモードを導入し、ユーザーの好みに合わせた表示を可能にしました。これにより、ユーザーの視覚的な快適性を向上させました。
  * **コンポーネントの活用**: 共通部分をBladeコンポーネントとして切り出し、部品化しました。これにより、コードの再利用性を高め、変更を一箇所で行えるようにすることで開発効率とメンテナンス性を向上させました
  * **ユーザーテーブルの単一化**: 一般ユーザーと管理ユーザーを一つのテーブルで管理し、フラグで区別するように設計しました。これにより、データベース構造をシンプルに保ち、管理を効率化しました。

## 苦労した点と学び

  * **ユーザーテーブルの単一化**: 一つのテーブルで一般ユーザーと管理ユーザーをまとめて管理する構想で開発を始めましたが、Laravel標準の認証機能をカスタマイズする必要があり、実装が広範囲に及びました。この困難な課題を乗り越えたことで、Laravel標準の認証機能への理解と、既存フレームワークのカスタマイズ能力を大きく向上させることができました。
  * **住所自動入力機能の実装**: PHPのみで実装するとフォームのリセットが困難になるため、JavaScriptとの連携が必要でした。バックエンド側ではAPIとして実装し、フロントエンド側から呼び出す形を採用しました。APIのセキュリティについてはLaravel SanctumとLaravel Passportを比較検討し、このアプリケーションからのアクセスに限定されるため、シンプルで軽量な認証システムであるLaravel Sanctumを採用しました。この経験を通じて、フロントエンドとバックエンドの連携、API設計の基礎、そして適切な認証方式の選定について深く学ぶことができました。
  * **画像表示の効率化と保護の実装**: 商品画像の画像データはDBに格納しており、それを表示するためにPHPで出力すると全てがHTMLファイルに含まれるために肥大化する問題がありました。そのため商品画像へのアクセスをAPIとして実装し、住所自動入力機能と同様にLaravel Sanctumで保護することにしました。これによりページ表示の効率化を図りました。また画像表示をBladeコンポーネント化することで実装の効率化も図りました。この経験を通じて、パフォーマンス最適化のためのAPI設計、認証システムを応用したリソース保護、そしてコンポーネントベースの開発による再利用性と保守性の向上という、より実践的なWeb開発の知識とスキルを習得できました。

## 今後の展望/改善点

  * **注文後処理の実装**: 現状では受け付けたところで完了している注文処理の先のプロセス (管理ユーザーによる注文管理、一般ユーザーによる注文取り消しなど)を実装し、ECサイトとしての機能をより充実させたいです。
  * **一覧の絞り込み・並べ替え機能の実装**: 現在、登録データはIDの採番順に昇順で表示されています。データ量が増えた際に目的のデータに素早くアクセスできるよう、絞り込みや並べ替え機能を実装し、管理画面の操作性を向上させたいです。
  * **レスポンシブデザインの改良**: ハンバーガーメニュー導入など、狭い画面での表示効率と操作性をさらに向上させ、モバイルユーザーの利便性を高めたいです。
  * **コンポーネント化の推進**: Bladeコンポーネントによる部品化をさらに進めることで、コードの統一感を高め、保守性や開発効率をさらに向上させたいと考えています。
  * **表示の更なる効率化**: 画像の遅延ロードなどを実装して、表示の効率化を図りたいと考えています。
